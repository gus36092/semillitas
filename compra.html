<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrito de Compra</title>
    <link rel="stylesheet" href="compra.css">
</head>

<body>

<div class="cart-container">

    <h1>üõí Carrito de compra</h1>

    <div id="cartItems" class="cart-items"></div>

    <h2 id="totalGeneral" class="total-general">Total: $0.00</h2>

    <div class="buyer-box">
        <h3>Datos del comprador</h3>

        <label>Nombre:</label>
        <input type="text" id="userName">

        <label>√Årea:</label>
        <input type="text" id="userArea">
    </div>

    <button id="sendOrder" class="btn-final">Enviar pedido</button>

    <a href="index.html" class="back-link">‚Üê Volver al cat√°logo</a>
</div>

<!-- JS -->
<script src="compra.js"></script>

<!-- FIREBASE -->
<script type="module">
    import { initializeApp } 
      from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getDatabase, ref, push } 
      from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyA6omI2lb-R5VLxTqWu56ct65vrhGyrk80",
        authDomain: "semillitas-project.firebaseapp.com",
        projectId: "semillitas-project",
        storageBucket: "semillitas-project.appspot.com",
        messagingSenderId: "632655626806",
        appId: "1:632655626806:web:26fe89b0ea334832830e97",
        databaseURL: "https://semillitas-project-default-rtdb.firebaseio.com/"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Guardar pedido
    document.getElementById("sendOrder").onclick = async () => {

        const name = document.getElementById("userName").value;
        const area = document.getElementById("userArea").value;

        if (!name || !area) {
            alert("Completa tu nombre y √°rea.");
            return;
        }

        const cart = JSON.parse(localStorage.getItem("cart")) || [];

        if (cart.length === 0) {
            alert("Tu carrito est√° vac√≠o.");
            return;
        }

        const order = {
            nombre: name,
            area: area,
            productos: cart,
            fecha: new Date().toISOString()
        };

        const pedidosRef = ref(db, "pedidos");
        await push(pedidosRef, order);

        alert("Pedido enviado correctamente.");

        localStorage.removeItem("cart");
        window.location.href = "index.html";
    };
</script>

</body>
</html>
