<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compra</title>

    <!-- CORREGIDO -->
    <link rel="stylesheet" href="compra.css">
</head>

<body>

    <div class="container">
        <img id="buyImg" src="" alt="Imagen">
        <h1 id="buyName"></h1>
        <h2 id="buyPrice"></h2>
        <p id="buyDesc"></p>

        <label for="qty">Cantidad:</label>
        <input type="number" id="qty" value="1" min="1">

        <button id="confirmBtn">Confirmar compra</button>
        <a href="index.html" class="back">← Volver al catálogo</a>
    </div>

    <!-- MODAL FORM -->
    <div id="formModal" class="modal">
        <div class="modal-content">
            <span id="closeForm" class="close">&times;</span>

            <h2>Finalizar Compra</h2>

            <label>Nombre:</label>
            <input type="text" id="userName">

            <label>Área:</label>
            <input type="text" id="userArea">

            <button id="sendOrder">Enviar pedido</button>
        </div>
    </div>

    <script src="compra.js"></script>

    <!-- FIREBASE -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
        import { getDatabase, ref, push }
            from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA6omI2lb-R5VLxTqWu56ct65vrhGyrk80",
            authDomain: "semillitas-project.firebaseapp.com",
            projectId: "semillitas-project",
            storageBucket: "semillitas-project.appspot.com",
            messagingSenderId: "632655626806",
            appId: "1:632655626806:web:26fe89b0ea334832830e97",
            measurementId: "G-LFG4GEHCE1",
            databaseURL: "https://semillitas-project-default-rtdb.firebaseio.com/"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getDatabase(app);

        document.getElementById("sendOrder").onclick = async () => {

            const name = document.getElementById("userName").value;
            const area = document.getElementById("userArea").value;
            const qty = document.getElementById("qty").value;
            const product = document.getElementById("buyName").textContent;

            if (!name || !area) {
                alert("Completa todos los campos.");
                return;
            }

            const order = {
                nombre: name,
                area: area,
                producto: product,
                cantidad: qty,
                fecha: new Date().toISOString()
            };

            await push(ref(db, "pedidos"), order);

            alert("Pedido enviado correctamente.");
            document.getElementById("formModal").style.display = "none";
        };
    </script>

</body>
</html>
